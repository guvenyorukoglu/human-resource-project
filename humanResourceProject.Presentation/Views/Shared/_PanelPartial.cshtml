<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet" />

<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />

<link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
@using System.Security.Claims
<div class="panel col-md-3 cold-lg-3">
    <div class="profile row">
        <div class="picture">
            <img src="@(User.Claims.FirstOrDefault(x => x.Type == "ImagePath").Value)" alt="profileImage" />
           

        </div>
        <div class="text-center">
            <a href="javascript:void(0);" onclick="openFileDialog()"><i class="fas fa-edit"></i></a>
        </div>
        <div class="name text-center">
            <h3>@(User.Claims.FirstOrDefault(x => x.Type == ClaimTypes.Name).Value + " " + User.Claims.FirstOrDefault(x => x.Type == ClaimTypes.Surname).Value)</h3>
        </div>


    </div>

    <div class="ul">
        <div class="panel-items">
            <ul class="panel-list">
                <li>
                    <a asp-action="Home" asp-controller="Employee"><i class="fa-solid fa-calendar-days"></i>Dashboard</a>
                </li>
                <li class="parent">
                    <a href="#"><i class="fa fa-users"></i>Talepler</a>
                    <ul class="sub-menu">
                        <li>
                            <a asp-action="MyLeaves" asp-controller="Leave"><i class="fa fa-users"></i>İzin Taleplerim</a>
                        </li>
                        <li>
                            <a asp-action="MyAdvances" asp-controller="Advance"><i class="fa fa-users"></i>Avans Taleplerim</a>
                        </li>
                        <li>
                            <a asp-action="MyExpenses" asp-controller="Expense"><i class="fa fa-users"></i>Masraf Taleplerim</a>
                        </li>
                    </ul>
                </li>

                @if (User.IsInRole("CompanyManager") || User.IsInRole("DepartmentManager"))
                {
                    <li class="parent">
                        <a href="#"><i class="fa fa-users"></i>Onay Bekleyen Talepler</a>
                        <ul class="sub-menu">
                            <li>
                                <a asp-action="EmployeesLeaves" asp-controller="Leave">Personel İzin Talepleri</a>
                            </li>
                            <li>
                                <a asp-action="EmployeesAdvances" asp-controller="Advance">Personel Avans Talepleri</a>
                            </li>
                            <li>
                                <a asp-action="EmployeesExpenses" asp-controller="Expense">Personel Masraf Talepleri</a>
                            </li>
                        </ul>
                    </li>
                }

                <li>
                    <a href="#"><i class="fa fa-newspaper"></i>Raporlar</a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-calendar"></i>Takvim</a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-envelope"></i>E-posta</a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-cog"></i>Ayarlar</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="log-out-button text-center">
        <a asp-controller="Account" asp-action="Logout" class="custom-button custom-button--logout">Çıkış Yap</a>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(document).ready(function () {
        $(".parent").click(function () {
            $(this).find(".sub-menu").slideToggle();
        });
    });
</script>

<script>
    function openFileDialog() {

        var input = document.createElement('input');
        input.type = 'file';

        input.onchange = function (e) {
            var file = e.target.files[0];
            if (file) {
                var formData = new FormData();
                formData.append('file', file); 
                $.ajax({
                    url: 'api/Account/UpdateProfileImage', 
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        alert("Profil resmi güncellendi");

                    },
                    error: function (xhr, status, error) {
                       alert("Bir hata oluştu");
                    }
                });
            }
        };

        input.click();
    }
</script>