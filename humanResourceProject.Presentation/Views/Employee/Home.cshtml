@model DashboardVM
@{
    ViewData["Title"] = "Home";
    Layout = "~/Views/Shared/_HRLayout.cshtml";
    int numberOfPendingLeaves;
    int numberOfPendingExpenses;
    int numberOfPendingAdvances;
    string title;

    if (User.IsInRole("Personel"))
    {
        numberOfPendingLeaves = Model.MyPendingLeavesCount;
        numberOfPendingExpenses = Model.MyPendingExpensesCount;
        numberOfPendingAdvances = Model.MyPendingAdvancesCount;
        title = "ONAY BEKLEYEN TALEPLERİM";


    }
    else if (User.IsInRole("Manager") || User.IsInRole("CompanyManager"))
    {
        numberOfPendingLeaves = Model.LeavesToBeCompletedByManager.Count;
        numberOfPendingExpenses = Model.ExpensesToBeCompletedByManager.Count;
        numberOfPendingAdvances = Model.AdvancesToBeCompletedByManager.Count;
        title = "ONAY BEKLEYEN TALEPLER";
    }
    else
    {
        numberOfPendingLeaves = 0;
        numberOfPendingExpenses = 0;
        numberOfPendingAdvances = 0;
        title = "";
    }
}



<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Index</title>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>



    <script>
        var eventName = [];
        var start = [];
        var end = [];

        //Todo: push metotları yazılacak

        document.addEventListener("DOMContentLoaded", function () {
            var calendarEl = document.getElementById("calendar");
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: "dayGridMonth",
                locale: "tr",
                selectable: true,
                selectHelper: true,
                select: function () {
                    $("#calendarEventModal").modal("toggle");
                },
                headerToolbar: {
                    left: "prev,next today",
                    center: "title",
                    right: "dayGridMonth,timeGridWeek,timeGridDay",
                },
                events: [
                    {
                        title: eventName,
                        start: start,
                        end: end,
                        color: "yellow",
                    },
                ],
            });

            calendar.render();
        });


    </script>

</head>
<body>
    <div class="row">
        
        @Html.Partial("_PanelPartial")
  

        <div class="aside col-md-9 container">
            <div class="row text-center">
                <div class="col-md-3 leave-info card">
                    <h6>@title</h6>

                    <canvas class="mb-3" id="myChart" style="margin:0 auto; width:250px; "></canvas>
                    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js"></script>


                    <script>
                        document.addEventListener("DOMContentLoaded", function () {
                            const ctx = document.getElementById("myChart");

                            var numberOfPendingLeaves;
                            var numberOfPendingExpenses;
                            var numberOfPendingAdvances;

                            new Chart(ctx, {
                                type: "doughnut",
                                data:
                                {
                                    labels: [],
                                    datasets:
                                        [
                                            {
                                                label: "",
                                                data: [@numberOfPendingLeaves, @numberOfPendingExpenses, @numberOfPendingAdvances],

                                                backgroundColor: [
                                                    '#FF6384',
                                                    '#36A2EB',
                                                    '#FFCD56'
                                                ],
                                                borderWidth: 1,
                                            },

                                        ],
                                },


                                options: {




                                    plugins: {
                                        legend: {
                                            labels: {
                                                font: {
                                                    size: 14
                                                }
                                            }
                                        }
                                    }

                                },


                                onClick: function (evt) {
                                    var activePoints = myChart.getElementsAtEventForMode(
                                        evt,
                                        "point",
                                        myChart.options
                                    );

                                    if (activePoints.length > 0) {
                                        var clickedElementIndex = activePoints[0].index;

                                        // Tıklanan etiketin indeksini kullanarak ilgili bağlantıya yönlendirme
                                        switch (clickedElementIndex) {
                                            case 0:
                                                window.location.href = "/Leave/EmployeesLeaves.html";
                                                break;
                                            case 1:
                                                window.location.href = "link2.html";
                                                break;
                                            case 2:
                                                window.location.href = "link3.html";
                                                break;
                                            default:
                                                break;
                                        }
                                    }
                                },







                            });

                            document.getElementById("numberOfPendingLeaves").innerHTML = "Bekleyen İzinler: " + @numberOfPendingLeaves;

                            document.getElementById("numberOfPendingExpenses").innerHTML = "Bekleyen Harcamalar: " + @numberOfPendingExpenses

                                document.getElementById("numberOfPendingAdvances").innerHTML = "Bekleyen Avanslar: " + @numberOfPendingAdvances;

                        });


                    </script>

                   

                    <button onclick="checkButtonColor(this)" style="background-color:#FF6384;" id="numberOfPendingLeaves" class="numberOfPendingLeaves mt-1">
                        Bekleyen İzinler
                    </button>

                    <button onclick="checkButtonColor(this)" style="background-color:#36A2EB;" id="numberOfPendingExpenses" class="numberOfPendingLeaves mt-1">
                        Bekleyen Harcamalar
                    </button>

                    <button onclick="checkButtonColor(this)" style="background-color:#FFCD56;" id="numberOfPendingAdvances" class="numberOfPendingLeaves mt-1">
                        Bekleyen Avanslar
                    </button>

                    <script>
                        function checkButtonColor(clickedButton) {
                            var buttonColor = window.getComputedStyle(clickedButton).backgroundColor;

                         
                            var rgbLeaves = 'rgb(255, 99, 132)';
                            var rgbExpenses = 'rgb(54, 162, 235)';
                            var rgbAdvances = 'rgb(255, 205, 86)';

                            if (buttonColor === rgbLeaves) {
                                window.location.href = "/Leave/EmployeesLeaves";
                            } else if (buttonColor === rgbExpenses) {
                                window.location.href = "/Expense/EmployeesExpenses";
                            } else if (buttonColor === rgbAdvances) {
                                window.location.href = "/Advance/EmployeesAdvances";
                            }
                        }
                    </script>

                    @{
                        decimal totalLeaveDays = 0;
                        if (Model != null)
                        {

                            if (Model.MyLeaves != null)
                            {
                                foreach (var leave in Model.MyLeaves)
                                {
                                    totalLeaveDays += leave.DaysOfLeave;
                                }
                            }
                        }
                    }
                </div>

                <div class="col-md-4 calender card">
                    <div id="calendar" style="width: 90%"></div>
                </div>


                <div class="col-md-4 holiday-info card">
                    <h6>ŞİRKET BİLGİLERİ</h6>
                    <div class="d-flex flex-column gap-2">
                        <div class="d-flex gap-2 justify-content-center align-items-center"><i class="fa-solid fa-building"></i><span>@Model.Company.CompanyName</span></div>
                        <div class="d-flex gap-2 justify-content-center align-items-center"><i class="fa-solid fa-location-dot"></i><span>@Model.Company.Address</span></div>
                        <div class="d-flex gap-2 justify-content-center align-items-center"><i class="fa-solid fa-phone"></i><span>@Model.Company.PhoneNumber</span></div>
                        <div class="d-flex gap-2 justify-content-center align-items-center"><span class="fw-bold">Vergi No:</span><span>@Model.Company.TaxNumber</span></div>
                        <div class="d-flex gap-2 justify-content-center align-items-center"><span class="fw-bold">Vergi Dairesi:</span><span>@Model.Company.TaxOffice</div>
                    </div>
                </div>

               @* <div class="row text-center">*@
                    <div class="col-md-3 upcoming-leave-info card">
                        <h6>
                            <a asp-action="MyLeaves" asp-controller="Leave">İZİNLER</a>
                        </h6>
                        <table class="table table-striped table-borderless">
                            <thead>
                                <tr>
                                    <th style="width: 33%;">İzin No</th>
                                    <th style="width: 33%;">İzin Gün Sayısı</th>
                                    <th style="width: 33%;">İstek Tarihi</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model != null)
                                {
                                    int count = 0;
                                    foreach (var leave in Model.MyLeaves)
                                    {
                                        if (count >= 5)
                                        {
                                            break;
                                        }

                                        if (leave != null)
                                        {
                                            <tr>
                                                <td style="font-size: 16px; text-transform: uppercase;">@leave.LeaveNo</td>
                                                <td style="font-size: 16px; text-transform: uppercase;">@leave.DaysOfLeave</td>
                                                <td style="font-size: 16px; text-transform: uppercase;">@leave.CreateDate.ToShortDateString()</td>
                                            </tr>
                                            count++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>


                    <div class="col-md-4 upcoming-expense-info card">
                        <h6>
                            <a asp-action="MyExpenses" asp-controller="Expense">MASRAFLAR</a>
                        </h6>
                        <table class="table table-striped table-borderless">
                            <thead>
                                <tr>
                                    <th style="width: 33%;">Masraf No</th>
                                    <th style="width: 33%;">Miktarı</th>
                                    <th style="width: 33%;">İstek Tarihi</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model != null)
                                {
                                    int count = 0;
                                    foreach (var expense in Model.MyExpenses)

                                    {
                                        if (count >= 5)
                                        {
                                            break;
                                        }

                                        if (expense != null)
                                        {
                                            <tr>
                                                <td style="font-size: 16px;">@expense.ExpenseNo</td>
                                                <td style="font-size: 16px;">@expense.AmountOfExpense</td>
                                                <td style="font-size: 16px;">@expense.CreateDate.ToShortDateString()</td>
                                            </tr>
                                            count++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-4 upcoming-advance-info card shadow-lg">
                        <h6>
                            <a asp-action="MyAdvances" asp-controller="Advance">AVANSLAR</a>
                        </h6>
                        <table class="table table-striped table-borderless">
                            <thead>
                                <tr>
                                    <th style="width: 33%;">Avans No</th>
                                    <th style="width: 33%;">Avans Miktarı</th>
                                    <th style="width: 33%;">İstek Tarihi</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model != null)
                                {
                                    int count = 0;
                                    foreach (var advance in Model.MyAdvances)
                                    {
                                        if (count >= 5)
                                        {
                                            break;
                                        }

                                        if (advance != null)
                                        {
                                            <tr>
                                                <td style="font-size: 16px;">@advance.AdvanceNo</td>
                                                <td style="font-size: 16px;">@advance.AmountOfAdvance</td>
                                                <td style="font-size: 16px;">@advance.CreateDate.ToShortDateString()</td>
                                            </tr>
                                            count++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                    <div id="calendarEventModal" class="modal fade" role="dialog">
                        <div class="modal-dialog modal-md text-center">
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">
                                        &times;
                                    </button>
                                    <h4 class="modal-title">Etkinlik Oluştur</h4>
                                </div>
                                <div class="modal-body">
                                    <form action="" class="form-control">
                                        <label for="Etkinlik">Etkinlik Adı</label>
                                        <input type="text" />
                                        <hr />
                                        <label for="Etkinlik">Etkinlik Başlangıç Zamanı</label>
                                        <input type="date" />
                                        <hr />
                                        <label for="Etkinlik">Etkinlik Bitiş Zamanı</label>
                                        <input type="date" />
                                        <hr />
                                        <button class="btn btn-primary">Kaydet</button>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
           @* </div>*@
        </div>

    </div>

</body>


